# Telegram-–±–æ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–ª—É–±–∞ MangaBuff

–ë–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–æ—Å–∞ –∫–∞—Ä—Ç –∫–ª—É–±–∞ –Ω–∞ —Å–∞–π—Ç–µ mangabuff.ru —Å —Å–∏—Å—Ç–µ–º–æ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç
- ‚ö° –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã boost –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- üîî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –∫–∞—Ä—Ç
- üéØ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞ –∫–∞—Ä—Ç—ã —á–µ—Ä–µ–∑ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ
- üåê –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ (RU/UA/BY)

### –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- üìÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –∑–∞–≤—Ç—Ä–∞
- ‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—á–∞—Å—Ç–∏—è
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ–Ω–∞ –ø—Ä–∏ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
- üìä –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–µ–π

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- üîê –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (TG-–≥—Ä—É–ø–ø–∞ + –∫–ª—É–± –Ω–∞ —Å–∞–π—Ç–µ)
- üë§ –ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ MangaBuff
- üîï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd memento_mori
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ
LOGIN_EMAIL=your_email@example.com
LOGIN_PASSWORD=your_password

# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token_here
ADMIN_TG_ID=123456789
REQUIRED_TG_GROUP_ID=-1001234567890
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ —Ä–∞–Ω–≥–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `ranks/` –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–º–æ–∫ –∫–∞—Ä—Ç:

```
ranks/
‚îú‚îÄ‚îÄ frame-e.png    # –†–∞–Ω–≥ E
‚îú‚îÄ‚îÄ frame-d.png    # –†–∞–Ω–≥ D
‚îú‚îÄ‚îÄ frame-c.png    # –†–∞–Ω–≥ C
‚îú‚îÄ‚îÄ frame-b.png    # –†–∞–Ω–≥ B
‚îú‚îÄ‚îÄ frame-a.png    # –†–∞–Ω–≥ A
‚îî‚îÄ‚îÄ frame-s.png    # –†–∞–Ω–≥ S
```

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≥–æ —Ä–∞–Ω–≥–∞:
```
frame-e.png
frame-e-v2.png
frame-e-v3.png
```

### 4. –ó–∞–ø—É—Å–∫

```bash
python main.py
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ MangaBuff |
| `/status` | –¢–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–∞ –∫–ª—É–±–∞ |
| `/myaccount` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| `/unlink` | –û—Ç–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç MangaBuff |
| `/mybookings` | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π |
| `/cancelbooking` | –û—Ç–º–µ–Ω–∏—Ç—å —Å–≤–æ—é –±—Ä–æ–Ω—å |
| `/myhistory` | –ò—Å—Ç–æ—Ä–∏—è —Å–≤–æ–∏—Ö –±—Ä–æ–Ω–µ–π |
| `/schedule` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –±—Ä–æ–Ω–µ–π |
| `–±—Ä–æ–Ω—å` / `–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å` | –ó–∞–ø—É—Å–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/listusers` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `/removeuser <tg_id>` | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/toggleuser <tg_id>` | –í–∫–ª/–≤—ã–∫–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `/syncclub` | –ü–µ—Ä–µ—Å–ø–∞—Ä—Å —Å–ø–∏—Å–∫–∞ —á–ª–µ–Ω–æ–≤ –∫–ª—É–±–∞ |
| `/allbookings` | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –±—Ä–æ–Ω–∏ |
| `/bookinghistory <tg_id>` | –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/bookinghistory all` | –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–µ–π |
| `/admincancel <booking_id>` | –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
memento_mori/
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ timezone_utils.py        # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –ú–°–ö
‚îÇ
‚îú‚îÄ‚îÄ auth.py                  # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ
‚îú‚îÄ‚îÄ rank_detector.py         # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞ –∫–∞—Ä—Ç—ã
‚îú‚îÄ‚îÄ proxy_manager.py         # –†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏
‚îú‚îÄ‚îÄ rate_limiter.py          # Rate limiting
‚îÇ
‚îú‚îÄ‚îÄ parser.py                # –ü–∞—Ä—Å–∏–Ω–≥ boost-—Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îú‚îÄ‚îÄ club_parser.py           # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–ª—É–±–∞
‚îÇ
‚îú‚îÄ‚îÄ database.py              # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ
‚îú‚îÄ‚îÄ notifier.py              # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ registration.py          # FSM —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ handlers.py              # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ admin_handlers.py        # –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ booking.py               # FSM –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ booking_handler.py       # –¢—Ä–∏–≥–≥–µ—Ä –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ booking_validator.py     # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤
‚îú‚îÄ‚îÄ booking_scheduler.py     # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ schedule_view.py         # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ ranks/                   # –®–∞–±–ª–æ–Ω—ã —Ä–∞–Ω–≥–æ–≤ –∫–∞—Ä—Ç
‚îú‚îÄ‚îÄ .env                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îî‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

SQLite –±–∞–∑–∞ `bot_data.db` —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏:

- `club_cards` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∫–∞—Ä—Ç –∫–ª—É–±–∞
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞
- `bookings` ‚Äî –±—Ä–æ–Ω–∏
- `booking_events` ‚Äî –ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—Ä–æ–Ω–µ–π

## –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –í–µ—Å—å –ø—Ä–æ–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ **–ú–°–ö (Europe/Moscow, UTC+3)**.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `datetime.now()` –±–µ–∑ timezone **–∑–∞–ø—Ä–µ—â–µ–Ω–æ**. –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `now_msk()` –∏–∑ `timezone_utils.py`.

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- `bot.log` ‚Äî —Ñ–∞–π–ª
- –ö–æ–Ω—Å–æ–ª—å ‚Äî stdout

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `INFO`

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

1. –°–æ–∑–¥–∞–π—Ç–µ handler –≤ `handlers.py` –∏–ª–∏ `admin_handlers.py`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ `register_*_handlers()`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤:
- `booking_validator.py` ‚Äî —Ä–∞—Å—á—ë—Ç —Å–ª–æ—Ç–æ–≤
- `booking_scheduler.py` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
- `booking.py` ‚Äî FSM –ø—Ä–æ—Ü–µ—Å—Å

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –∫–ª—É–±–∞ ¬´–¢–∞—Ä–æ¬ª –Ω–∞ MangaBuff
